import "dart:io";
import 'package:html/parser.dart' show parse;
import 'package:recase/recase.dart';

void main(List<String> args) {
  File iconsHtmlFile = File(args[0]);

  if (!iconsHtmlFile.existsSync()) {
    print('icons HTML file not found');
    exit(0);
  }

  String content = iconsHtmlFile.readAsStringSync();
  final document = parse(content);
  final icons = document.getElementsByClassName('unicode-icon');

  List<String> generatedOutput = [
    "library lucide_icons;\n\n",
    "import \"package:flutter/widgets.dart\";\n",
    "import \"src/icon_data.dart\";\n\n",
    "// THIS FILE IS AUTOMATICALLY GENERATED!\n\n",
    "class LucideIcons {\n"
  ];

  for (final icon in icons) {
    final nameElement = icon.querySelector('h4');
    final unicodeElement = icon.querySelector('.unicode');

    if (nameElement == null || unicodeElement == null) continue;

    final name = nameElement.text.trim();
    final unicodeStr = unicodeElement.text.trim();

    final decimalCode =
        int.tryParse(unicodeStr.replaceAll(RegExp(r'[^\d]'), ''));

    if (decimalCode == null) continue;

    final hexCode = decimalCode.toRadixString(16).toUpperCase();

    generatedOutput.add(
        "  static const IconData ${ReCase(name).camelCase} = const LucideIconData(0x$hexCode);\n");

    print('Parsed: $name -> 0x$hexCode');
  }

  generatedOutput.add("}\n");

  File output = File('./lib/custom_icons.dart');
  output.writeAsStringSync(generatedOutput.join());
}
